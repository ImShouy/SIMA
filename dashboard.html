<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMA - Dashboard</title>
    <link rel="stylesheet" href="public/assets/styles/fonts.css">
    <link rel="stylesheet" href="public/assets/styles/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">SIMA</div>
                <button class="toggle-menu" id="toggle-menu"><i class="fas fa-bars"></i></button>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <li class="active" data-target="home">
                        <a href="#">
                            <i class="fas fa-home"></i>
                            <span data-i18n="nav_home">Inicio</span>
                        </a>
                    </li>
                    <li data-target="parcels">
                        <a href="#">
                            <i class="fas fa-layer-group"></i>
                            <span data-i18n="nav_parcels">Parcelas</span>
                        </a>
                    </li>
                    <li data-target="devices">
                        <a href="#">
                            <i class="fas fa-microchip"></i>
                            <span data-i18n="nav_devices">Dispositivos IoT</span>
                        </a>
                    </li>
                    <li data-target="linking">
                        <a href="#">
                            <i class="fas fa-link"></i>
                            <span data-i18n="nav_linking">Vinculaci칩n</span>
                        </a>
                    </li>
                    <li data-target="map-view">
                        <a href="#">
                            <i class="fas fa-map-marked-alt"></i>
                            <span data-i18n="nav_map">Mapa</span>
                        </a>
                    </li>
                    <li data-target="pests">
                        <a href="#">
                            <i class="fas fa-bug"></i>
                            <span data-i18n="nav_pests">Plagas</span>
                        </a>
                    </li>
                    <li data-target="fertilizers">
                        <a href="#">
                            <i class="fas fa-flask"></i>
                            <span data-i18n="nav_fertilizers">Fertilizantes</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar-divider"></div>

                <ul>
                    <li data-target="notifications">
                        <a href="#">
                            <i class="fas fa-bell"></i>
                            <span data-i18n="nav_notifications">Notificaciones</span>
                            <span class="badge" id="notif-badge">0</span>
                        </a>
                    </li>
                    <li data-target="settings">
                        <a href="#">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="nav_settings">Configuraci칩n</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="avatar">U</div>
                    <div class="user-info">
                        <span class="name">Usuario</span>
                        <span class="role">Agricultor</span>
                    </div>
                </div>
                <button class="logout-btn" id="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-header">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Buscar en tu granja..." data-i18n-placeholder="search_placeholder">
                </div>
                <div class="header-actions">
                    <button class="icon-btn"><i class="fas fa-question-circle"></i></button>
                    <button class="icon-btn"><i class="fas fa-bell"></i></button>
                </div>
            </header>

            <!-- Content Sections -->
            <div class="content-wrapper">
                
                <!-- Home Section -->
                <section id="home" class="view-section active">
                    <div class="welcome-banner">
                        <h1 data-i18n="welcome_title">춰Hola, Usuario! 游녦</h1>
                        <p data-i18n="welcome_subtitle">Aqu칤 tienes un resumen de tu actividad reciente.</p>
                    </div>
                    
                    <h2 class="section-title" data-i18n="quick_access">Acceso R치pido</h2>
                    <div class="quick-actions-grid">
                        <div class="action-card" onclick="navigateTo('parcels')">
                            <div class="icon-box green"><i class="fas fa-seedling"></i></div>
                            <h3 data-i18n="card_parcels_title">Mis Parcelas</h3>
                            <p data-i18n="card_parcels_desc">Gestiona tus cultivos</p>
                        </div>
                        <div class="action-card" onclick="navigateTo('devices')">
                            <div class="icon-box yellow"><i class="fas fa-wifi"></i></div>
                            <h3 data-i18n="card_devices_title">Dispositivos</h3>
                            <p data-i18n="card_devices_desc">Monitorea tus sensores</p>
                        </div>
                        <div class="action-card" onclick="navigateTo('linking')">
                            <div class="icon-box blue"><i class="fas fa-network-wired"></i></div>
                            <h3 data-i18n="card_link_title">Vincular</h3>
                            <p data-i18n="card_link_desc">Conecta dispositivos</p>
                        </div>
                    </div>

                    <h2 class="section-title" data-i18n="system_status">Estado del Sistema</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-value" id="stat-parcels">0</span>
                            <span class="stat-label" data-i18n="stat_active_parcels">Parcelas Activas</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="stat-sensors">0</span>
                            <span class="stat-label" data-i18n="stat_online_sensors">Sensores Online</span>
                        </div>
                        <div class="stat-card warning">
                            <span class="stat-value" id="stat-alerts">0</span>
                            <span class="stat-label" data-i18n="stat_pending_alerts">Alertas Pendientes</span>
                        </div>
                    </div>
                </section>

                <!-- Parcels Section -->
                <section id="parcels" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_parcels_title">Mis Parcelas</h2>
                        <button class="btn-primary" id="btn-add-parcel"><i class="fas fa-plus"></i> <span data-i18n="btn_new_parcel">Nueva Parcela</span></button>
                    </div>
                    <div class="parcels-grid" id="parcels-container">
                        <!-- Dynamic Content -->
                        <div class="empty-state">
                            <img src="public/assets/images/dashboards.jpg" alt="No parcels">
                            <p>No tienes parcelas registradas a칰n.</p>
                            <button class="btn-secondary">Registrar mi primera parcela</button>
                        </div>
                    </div>
                </section>

                <!-- Devices Section -->
                <section id="devices" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_devices_title">Dispositivos IoT</h2>
                        <button class="btn-primary" id="btn-add-device"><i class="fas fa-plus"></i> <span data-i18n="btn_new_device">Nuevo Dispositivo</span></button>
                    </div>
                    <div class="devices-list" id="devices-container">
                        <!-- Dynamic Content -->
                        <div class="empty-state">
                            <i class="fas fa-microchip fa-3x"></i>
                            <p>No hay dispositivos registrados.</p>
                        </div>
                    </div>
                </section>

                <!-- Linking Section -->
                <section id="linking" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_linking_title">Vinculaci칩n</h2>
                        <p data-i18n="section_linking_desc">Asocia tus dispositivos IoT a tus parcelas para comenzar a monitorear.</p>
                    </div>
                    <div class="linking-interface">
                        <div class="link-step">
                            <h3 data-i18n="link_step_1">1. Selecciona una Parcela</h3>
                            <select id="link-parcel-select" class="form-select">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="link-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                        <div class="link-step">
                            <h3 data-i18n="link_step_2">2. Selecciona Dispositivos</h3>
                            <div id="link-devices-list" class="checkbox-list">
                                <p class="text-muted">Selecciona una parcela primero</p>
                            </div>
                        </div>
                    </div>
                    <div class="link-actions">
                        <button class="btn-primary" id="btn-link-confirm" disabled data-i18n="btn_link_confirm">Vincular Dispositivos</button>
                    </div>
                </section>

                <!-- Map Section -->
                <section id="map-view" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_map_title">Mapa de Cultivos</h2>
                        <p data-i18n="section_map_desc">Visualiza el estado de tus parcelas en tiempo real.</p>
                    </div>
                    <div id="map-container" style="height: 600px; width: 100%; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <div id="map" style="height: 100%; width: 100%;"></div>
                    </div>
                    <div class="map-legend" style="margin-top: 15px; display: flex; gap: 20px; justify-content: center;">
                        <div style="display: flex; align-items: center; gap: 5px;"><span style="width: 12px; height: 12px; background: #2ecc71; border-radius: 50%; display: inline-block;"></span> Normal</div>
                        <div style="display: flex; align-items: center; gap: 5px;"><span style="width: 12px; height: 12px; background: #f1c40f; border-radius: 50%; display: inline-block;"></span> Atenci칩n</div>
                        <div style="display: flex; align-items: center; gap: 5px;"><span style="width: 12px; height: 12px; background: #e74c3c; border-radius: 50%; display: inline-block;"></span> Cr칤tico</div>
                    </div>
                </section>

                <!-- Pests Section -->
                <section id="pests" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_pests_title">Registro de Plagas</h2>
                        <button class="btn-primary" id="btn-add-pest"><i class="fas fa-plus"></i> <span data-i18n="btn_new_pest">Registrar Plaga</span></button>
                    </div>
                    <div class="parcels-grid" id="pests-container">
                        <!-- Dynamic Content -->
                        <div class="empty-state">
                            <i class="fas fa-bug fa-3x"></i>
                            <p>No hay plagas registradas.</p>
                        </div>
                    </div>
                </section>

                <!-- Fertilizers Section -->
                <section id="fertilizers" class="view-section">
                    <div class="section-header">
                        <h2 data-i18n="section_fertilizers_title">Registro de Fertilizantes</h2>
                        <button class="btn-primary" id="btn-add-fertilizer"><i class="fas fa-plus"></i> <span data-i18n="btn_new_fertilizer">Registrar Fertilizante</span></button>
                    </div>
                    <div class="parcels-grid" id="fertilizers-container">
                        <!-- Dynamic Content -->
                        <div class="empty-state">
                            <i class="fas fa-flask fa-3x"></i>
                            <p>No hay fertilizantes registrados.</p>
                        </div>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section id="notifications" class="view-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 data-i18n="section_notifications_title" style="margin: 0;">Notificaciones</h2>
                        <div class="filter-group" style="display: flex; gap: 5px;">
                            <button class="btn-secondary active" onclick="filterNotifications('all')" style="padding: 5px 10px; font-size: 0.8rem;">Todos</button>
                            <button class="btn-secondary" onclick="filterNotifications('high')" style="padding: 5px 10px; font-size: 0.8rem; border-color: #e74c3c; color: #e74c3c;">Alta</button>
                            <button class="btn-secondary" onclick="filterNotifications('medium')" style="padding: 5px 10px; font-size: 0.8rem; border-color: #f39c12; color: #f39c12;">Media</button>
                            <button class="btn-secondary" onclick="filterNotifications('low')" style="padding: 5px 10px; font-size: 0.8rem; border-color: #3498db; color: #3498db;">Baja</button>
                        </div>
                    </div>
                    <div class="notifications-list" id="notifications-container">
                        <!-- Dynamic Content -->
                        <div class="empty-state">
                            <i class="fas fa-bell-slash fa-3x"></i>
                            <p>No tienes notificaciones nuevas.</p>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="view-section">
                    <h2 data-i18n="section_settings_title">Configuraci칩n</h2>
                    <div class="settings-panel">
                        <div class="setting-group">
                            <h3 data-i18n="settings_language_title">Idioma</h3>
                            <form id="form-language">
                                <div class="form-group">
                                    <label data-i18n="settings_language_label">Seleccionar Idioma</label>
                                    <select id="language-select" class="form-select">
                                        <option value="es">Espa침ol</option>
                                        <option value="en">English</option>
                                        <option value="qu">Quechua</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="setting-group">
                            <h3 data-i18n="settings_profile_title">Informaci칩n Personal</h3>
                            <form id="form-profile">
                                <div class="form-group">
                                    <label data-i18n="label_profile_photo">Foto de Perfil</label>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div id="profile-preview" style="width: 50px; height: 50px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                            <i class="fas fa-user" style="color: #ccc;"></i>
                                        </div>
                                        <input type="file" id="profile-photo" name="photo" accept="image/*" style="font-size: 0.9rem;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label data-i18n="label_name">Nombre</label>
                                    <input type="text" id="profile-name" name="name" value="Usuario Demo" required>
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="profile-email" name="email" value="usuario@andeva.com" required>
                                </div>
                                <button type="submit" class="btn-secondary" data-i18n="btn_save_changes">Guardar</button>
                            </form>
                        </div>
                        <div class="setting-group">
                            <h3 data-i18n="settings_security_title">Seguridad</h3>
                            <form id="form-password">
                                <div class="form-group">
                                    <label data-i18n="label_current_password">Contrase침a Actual</label>
                                    <input type="password" name="current-password" required placeholder="********">
                                </div>
                                <div class="form-group">
                                    <label data-i18n="label_new_password">Nueva Contrase침a</label>
                                    <input type="password" name="new-password" required placeholder="********">
                                </div>
                                <div class="form-group">
                                    <label data-i18n="label_confirm_password">Confirmar Nueva Contrase침a</label>
                                    <input type="password" name="confirm-password" required placeholder="********">
                                </div>
                                <button type="submit" class="btn-secondary" data-i18n="btn_update_password">Actualizar Contrase침a</button>
                                <button type="button" id="btn-view-history" class="btn-secondary" style="margin-top: 10px; background-color: #3498db; color: white; border: none;" data-i18n="btn_view_history">Ver Historial de Accesos</button>
                            </form>
                        </div>
                        <div class="setting-group" style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
                            <h3 data-i18n="settings_plan_title">Mi Plan</h3>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h4 id="current-plan-name" style="color: #2c3e50; margin: 0;">Gratuito</h4>
                                    <span id="plan-badge" style="background: #95a5a6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">Active</span>
                                </div>
                                <ul id="plan-features" style="list-style: none; padding: 0; margin: 0 0 15px 0; font-size: 0.9rem; color: #666;">
                                    <!-- Features rendered via JS -->
                                </ul>
                                <button type="button" id="btn-upgrade-plan" class="btn-secondary" style="width: 100%; background-color: #f1c40f; color: #2c3e50; border: none;" data-i18n="btn_upgrade">Mejorar Plan</button>
                            </div>
                        </div>
                        <div class="setting-group" style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
                            <h3 data-i18n="settings_notifications_title">Preferencias de Notificaciones</h3>
                            <div style="display: flex; align-items: center; margin-top: 15px;">
                                <input type="checkbox" id="email-notifications" style="margin-right: 10px; transform: scale(1.2);">
                                <label for="email-notifications" data-i18n="label_email_notifications">Recibir correos electr칩nicos</label>
                            </div>
                        </div>
                        <div class="setting-group" style="border-top: 1px solid #eee; margin-top: 20px; padding-top: 20px;">
                            <h3 style="color: #e74c3c;" data-i18n="settings_danger_zone">Zona de Peligro</h3>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;" data-i18n="settings_delete_desc">Una vez que elimines tu cuenta, no hay vuelta atr치s. Por favor, ten cuidado.</p>
                            <button type="button" id="btn-delete-account" class="btn-secondary" style="background-color: #e74c3c; color: white; border: none;" data-i18n="btn_delete_account">Eliminar Cuenta</button>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Parcel Modal -->
    <div id="modal-parcel" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Nueva Parcela</h2>
            <form id="form-parcel">
                <div class="form-group">
                    <label>Nombre de la Parcela</label>
                    <input type="text" name="name" required placeholder="Ej. Parcela Norte">
                </div>
                <input type="hidden" name="parcel-id" id="parcel-id">
                <div class="form-group">
                    <label>Tipo de Cultivo</label>
                    <select name="crop-select" id="crop-select" class="form-select">
                        <option value="">Seleccionar...</option>
                        <option value="Ma칤z">Ma칤z</option>
                        <option value="Papa">Papa</option>
                        <option value="Arroz">Arroz</option>
                        <option value="Caf칠">Caf칠</option>
                        <option value="Cacao">Cacao</option>
                        <option value="Palta">Palta</option>
                        <option value="Ar치ndano">Ar치ndano</option>
                        <option value="Uva">Uva</option>
                        <option value="other">Otro...</option>
                    </select>
                    <input type="text" name="crop-manual" id="crop-manual" placeholder="Especifique el cultivo" style="display: none; margin-top: 10px;">
                </div>
                <div class="form-group">
                    <label data-i18n="label_sowing_date">Fecha de Siembra</label>
                    <input type="date" name="sowing-date" required>
                </div>
                <div class="form-group">
                    <label>츼rea (m)</label>
                    <input type="number" name="area" required placeholder="1000">
                </div>
                <div class="form-group">
                    <label>Ubicaci칩n</label>
                    <div id="map-parcel-select" style="height: 200px; width: 100%; border-radius: 8px; margin-bottom: 10px;"></div>
                    <input type="hidden" name="lat" id="parcel-lat">
                    <input type="hidden" name="lng" id="parcel-lng">
                    <p style="font-size: 0.8rem; color: #666;">Arrastra el marcador para ubicar tu parcela.</p>
                </div>
                <button type="submit" class="btn-primary">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div id="modal-device" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Nuevo Dispositivo IoT</h2>
            <form id="form-device">
                <input type="hidden" name="device-id" id="device-id">
                <div class="form-group">
                    <label>ID del Dispositivo (Serial)</label>
                    <input type="text" name="serial" required placeholder="SN-123456">
                </div>
                <div class="form-group">
                    <label>Nombre/Alias</label>
                    <input type="text" name="name" required placeholder="Sensor Humedad 1">
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select name="type">
                        <option value="humidity">Sensor de Humedad</option>
                        <option value="temperature">Sensor de Temperatura</option>
                        <option value="ph">Sensor de pH</option>
                        <option value="station">Estaci칩n Meteorol칩gica</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Registrar Dispositivo</button>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Add Pest Modal -->
    <div id="modal-pest" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 data-i18n="modal_pest_title">Registrar Plaga</h2>
            <form id="form-pest">
                <div class="form-group">
                    <label data-i18n="label_pest_name">Nombre de la Plaga</label>
                    <input type="text" name="name" required placeholder="Ej. Pulg칩n">
                </div>
                <div class="form-group">
                    <label data-i18n="label_pest_type">Tipo</label>
                    <select name="type" class="form-select" required>
                        <option value="Insecto">Insecto</option>
                        <option value="Hongo">Hongo</option>
                        <option value="Bacteria">Bacteria</option>
                        <option value="Virus">Virus</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="label_pest_severity">Gravedad</label>
                    <select name="severity" class="form-select" required>
                        <option value="Baja">Baja</option>
                        <option value="Media">Media</option>
                        <option value="Alta">Alta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="label_pest_date">Fecha de Detecci칩n</label>
                    <input type="date" name="date" required>
                </div>
                <div class="form-group">
                    <label data-i18n="label_pest_parcel">Parcela Afectada</label>
                    <select name="parcel-id" id="pest-parcel-select" class="form-select" required>
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="label_pest_observation">Observaci칩n</label>
                    <textarea name="observation" rows="3" placeholder="Detalles adicionales..."></textarea>
                </div>
                <button type="submit" class="btn-primary" data-i18n="btn_save_pest">Guardar Plaga</button>
            </form>
        </div>
    </div>

    <!-- Add Fertilizer Modal -->
    <div id="modal-fertilizer" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 data-i18n="modal_fertilizer_title">Registrar Fertilizante</h2>
            <form id="form-fertilizer">
                <input type="hidden" name="fertilizer-id" id="fertilizer-id">
                <div class="form-group">
                    <label data-i18n="label_fertilizer_name">Nombre del Fertilizante</label>
                    <input type="text" name="name" required placeholder="Ej. Urea">
                </div>
                <div class="form-group">
                    <label data-i18n="label_fertilizer_type">Tipo</label>
                    <select name="type" class="form-select" required>
                        <option value="Org치nico">Org치nico</option>
                        <option value="Qu칤mico">Qu칤mico</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="label_fertilizer_date">Fecha de Aplicaci칩n</label>
                    <input type="date" name="date" required>
                </div>
                <div class="form-group">
                    <label data-i18n="label_fertilizer_parcel">Parcela Aplicada</label>
                    <select name="parcel-id" id="fertilizer-parcel-select" class="form-select" required>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label data-i18n="label_fertilizer_quantity">Cantidad/Dosis</label>
                    <input type="text" name="quantity" required placeholder="Ej. 50kg">
                </div>
                <button type="submit" class="btn-primary" data-i18n="btn_save_fertilizer">Guardar Fertilizante</button>
            </form>
        </div>
    </div>


    <!-- Login History Modal -->
    <div id="modal-history" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2 data-i18n="modal_history_title">Historial de Inicio de Sesi칩n</h2>
            <div class="table-responsive">
                <table class="table" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #f8f9fa; text-align: left;">
                            <th style="padding: 10px;" data-i18n="table_date">Fecha</th>
                            <th style="padding: 10px;" data-i18n="table_ip">IP</th>
                            <th style="padding: 10px;" data-i18n="table_device">Dispositivo</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- Dynamic Content -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="modal-calibration" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2>Calibraci칩n de Sensor</h2>
            
            <div id="calibration-step-1" class="calibration-step">
                <p>Este asistente le guiar치 en el proceso de calibraci칩n de su sensor. Aseg칰rese de que el dispositivo est칠 encendido y conectado.</p>
                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <strong>Instrucciones:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Limpie la superficie del sensor.</li>
                        <li>Mantenga el sensor en un ambiente estable.</li>
                        <li>No desconecte el dispositivo durante el proceso.</li>
                    </ul>
                </div>
                <button class="btn-primary" onclick="startCalibration()">Iniciar Calibraci칩n</button>
            </div>

            <div id="calibration-step-2" class="calibration-step" style="display: none; text-align: center;">
                <div style="margin: 30px 0;">
                    <i class="fas fa-cog fa-spin fa-3x" style="color: #80D643;"></i>
                    <h3 style="margin-top: 15px;" id="calibration-status">Conectando con sensor...</h3>
                    <div style="width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-top: 20px;">
                        <div id="calibration-progress" style="width: 0%; height: 100%; background: #80D643; border-radius: 5px; transition: width 0.5s;"></div>
                    </div>
                </div>
            </div>

            <div id="calibration-step-3" class="calibration-step" style="display: none; text-align: center;">
                <div id="calibration-result-success" style="display: none;">
                    <i class="fas fa-check-circle fa-4x" style="color: #2ecc71; margin-bottom: 15px;"></i>
                    <h3>춰Calibraci칩n Exitosa!</h3>
                    <p>El sensor ha sido calibrado correctamente y est치 listo para usar.</p>
                </div>
                <div id="calibration-result-error" style="display: none;">
                    <i class="fas fa-times-circle fa-4x" style="color: #e74c3c; margin-bottom: 15px;"></i>
                    <h3>Error de Calibraci칩n</h3>
                    <p>No se pudo completar la calibraci칩n. El sensor no responde.</p>
                    <button class="btn-secondary" onclick="retryCalibration()" style="margin-top: 15px;">Reintentar</button>
                </div>
                <button class="btn-primary" onclick="closeCalibrationModal()" style="margin-top: 20px;">Cerrar</button>
            </div>

            <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 15px;">
                <h4>Historial de Calibraci칩n</h4>
                <div id="calibration-history" style="max-height: 150px; overflow-y: auto; margin-top: 10px; font-size: 0.9rem;">
                    <!-- History items will be injected here -->
                </div>
            </div>
        </div>
    </div>
    
    <script src="public/assets/scripts/dashboard.js"></script>
</body>
</html>
